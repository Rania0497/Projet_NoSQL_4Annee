{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Race Platform RB</title>
    <link rel="stylesheet" href="{% static 'races/style.css' %}">
</head>
<body>

<!-- Header Navigation -->
<header class="main-header">
    <div class="header-container">
        <div class="logo">
            <h1>ğŸ Race Platform RB</h1>
        </div>
        <nav class="main-nav">
            <a href="#circuits">Circuits</a>
            <a href="#courses">Courses</a>
            <a href="#recherche">Recherche</a>
            <a href="#stats">Statistiques</a>
        </nav>
    </div>
</header>

<div class="container">
    
    <!-- Header Banner -->
    <div class="header">
        <h1>ğŸ Race Platform RB</h1>
        <p>DÃ©couvrez les circuits et courses automobiles</p>
    </div>

    <!-- Statistiques -->
    <div id="stats" class="stats-container">
        <div class="stat-card">
            <h3>ğŸŸï¸ Total Circuits</h3>
            <div class="stat-value">{{ stats.total_tracks }}</div>
        </div>
        
        <div class="stat-card">
            <h3>ğŸï¸ Total Courses</h3>
            <div class="stat-value">{{ stats.total_races }}</div>
        </div>
        
        <div class="stat-card">
            <h3>ğŸ† Plus Grand Circuit</h3>
            <div class="stat-value small">{{ stats.biggest_track }}</div>
            <div class="stat-label">{{ stats.biggest_seating }} places</div>
        </div>
        
        <div class="stat-card">
            <h3>â³ Plus Ancien</h3>
            <div class="stat-value small">{{ stats.oldest_track }}</div>
            <div class="stat-label">{{ stats.oldest_year }}</div>
        </div>
    </div>

    <!-- Section Recherche -->
    <div id="recherche" class="section">
        <h2> Rechercher des Courses</h2>
        <select id="trackSelect">
            <option value="">-- SÃ©lectionne un circuit --</option>
            {% for track in tracks %}
                <option value="{{ track.Track_ID }}">{{ track.Name }} ({{ track.Location }})</option>
            {% endfor %}
        </select>
        <ul id="raceList"></ul>
    </div>

    <!-- Circuits -->
    <div id="circuits" class="section">
        <h1>ğŸ Circuits</h1>
        <ul>
        {% for track in tracks %}
            <li>
                <strong>{{ track.Name }}</strong> - {{ track.Location }}
                <br>
                <small>ğŸ“ CapacitÃ©: {{ track.Seating }} | ğŸ“… Ouvert: {{ track.Year_Opened }}</small>
            </li>
        {% endfor %}
        </ul>
    </div>

    <!-- Courses -->
    <div id="courses" class="section">
        <h1>ğŸï¸ Courses</h1>
        <ul>
        {% for race in races %}
            <li>
                <strong>{{ race.Name }}</strong>
                <br>
                <small>ğŸ Classe: {{ race.Class }} | ğŸ“… Date: {{ race.Date }}</small>
            </li>
        {% endfor %}
        </ul>
    </div>

</div>

<!-- Footer -->
<footer class="main-footer">
    <div class="footer-container">
        <div class="footer-section">
            <h3>ğŸ Race Platform RB</h3>
            <p>Votre source d'information sur les circuits et courses automobiles</p>
        </div>
        <div class="footer-section">
            <h4>Navigation</h4>
            <ul>
                <li><a href="#circuits">Circuits</a></li>
                <li><a href="#courses">Courses</a></li>
                <li><a href="#recherche">Recherche</a></li>
                <li><a href="#stats">Statistiques</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Informations</h4>
            <ul>
                <li>Total: {{ stats.total_tracks }} circuits</li>
                <li>Total: {{ stats.total_races }} courses</li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Contact</h4>
            <p>ğŸ“§ contact@raceplatformrb.com</p>
            <p>ğŸ“ +212 XXX XXX XXX</p>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 Race Platform RB. Tous droits rÃ©servÃ©s.</p>
    </div>
</footer>

<!-- Stocker les donnÃ©es dans un Ã©lÃ©ment cachÃ© -->
<script id="races-data" type="application/json">
{{ races_json|safe }}
</script>

<script>
// Lire les donnÃ©es depuis l'Ã©lÃ©ment cachÃ©
const races = JSON.parse(document.getElementById('races-data').textContent);
console.log("Races chargÃ©es:", races);

document.getElementById('trackSelect').addEventListener('change', function() {
    const trackId = this.value;
    console.log("Circuit sÃ©lectionnÃ©:", trackId);
    
    const list = document.getElementById('raceList');
    list.innerHTML = '';  
    
    if(trackId) {
        const filtered = races.filter(r => String(r.Track_ID) === String(trackId));
        console.log("Courses trouvÃ©es:", filtered);
        
        if(filtered.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'Aucune course trouvÃ©e pour ce circuit';
            li.className = 'error-message';
            list.appendChild(li);
        } else {
            filtered.forEach(race => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${race.Name}</strong><br><small>ğŸ ${race.Class} | ğŸ“… ${race.Date}</small>`;
                list.appendChild(li);
            });
        }
    }
});

// Smooth scroll pour les liens d'ancrage
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if(target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>

</body>
</html>